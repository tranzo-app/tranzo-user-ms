@startuml
title Travel Platform - Chat & Notification Event Flow

actor User
actor Host
actor TripMember
actor "Interested User" as InterestedUser

participant "User Service" as UserSvc
participant "Trip Service" as TripSvc
participant "Chat Service" as ChatSvc
participant "Notification Service" as NotifSvc
participant Scheduler

== TRAVEL PAL FLOW ==

User -> UserSvc : Send TravelPal Request
UserSvc --> NotifSvc : TravelPalRequestSentEvent
NotifSvc --> User : ğŸ”” Push (1:1)

UserSvc --> ChatSvc : TravelPalRequestAcceptedEvent
ChatSvc -> ChatSvc : Create 1:1 Conversation (System)
UserSvc --> NotifSvc : TravelPalAcceptedEvent
NotifSvc --> User : ğŸ”” Push (1:1)

== TRIP CREATION ==

Host -> TripSvc : Create Trip
TripSvc --> ChatSvc : TripCreatedEvent
ChatSvc -> ChatSvc : Create Group Chat ğŸ’¬

TripSvc --> NotifSvc : TripCreatedEvent
NotifSvc --> InterestedUser : ğŸ”” Push (Broadcast - Similar Trips)

== JOIN TRIP FLOW ==

User -> TripSvc : Request to Join Trip
TripSvc --> NotifSvc : TripJoinRequestedEvent
NotifSvc --> Host : ğŸ”” Push (1:1)

Host -> TripSvc : Approves Join Request
TripSvc --> ChatSvc : TripMemberJoinedEvent
ChatSvc -> ChatSvc : "User joined the trip" ğŸ’¬

TripSvc --> NotifSvc : TripMemberJoinedEvent
NotifSvc --> TripMember : ğŸ”” Push (Broadcast)

User -> TripSvc : Leaves Trip
TripSvc --> ChatSvc : TripMemberLeftEvent
ChatSvc -> ChatSvc : "User left the trip" ğŸ’¬

TripSvc --> NotifSvc : TripMemberLeftEvent
NotifSvc --> TripMember : ğŸ”” Push (Broadcast)

== TRIP STATE CHANGES ==

TripSvc --> NotifSvc : TripUpdatedEvent
NotifSvc --> TripMember : ğŸ”” Push (Broadcast)

TripSvc --> NotifSvc : TripMarkedFullEvent
NotifSvc --> TripMember : ğŸ”” Push (Broadcast)

TripSvc --> NotifSvc : TripCancelledEvent
NotifSvc --> TripMember : ğŸ”” Push (Broadcast - High Priority)

TripSvc --> ChatSvc : MemberPromotedToCohostEvent
ChatSvc -> ChatSvc : System Message ğŸ’¬

== CHAT MESSAGES ==

User -> ChatSvc : Send Message
ChatSvc --> NotifSvc : MessageSentEvent
NotifSvc --> TripMember : ğŸ”” Push (1:1 to others)

== WISHLIST ALERTS ==

TripSvc --> NotifSvc : TripSeatThresholdReachedEvent
NotifSvc --> User : ğŸ”” Push (1:1 - Wishlisted Users)

== TRIP Q&A ==

User -> TripSvc : Ask Question
TripSvc --> NotifSvc : TripQuestionAskedEvent
NotifSvc --> TripMember : ğŸ”” Push (Broadcast)

TripMember -> TripSvc : Answer Question
TripSvc --> NotifSvc : TripQuestionAnsweredEvent
NotifSvc --> User : ğŸ”” Push (1:1 to Question Owner)

== REMINDERS & SYSTEM EVENTS ==

Scheduler --> NotifSvc : UpcomingTripReminderEvent
NotifSvc --> TripMember : ğŸ”” Push (Broadcast)

Scheduler --> NotifSvc : DraftTripIncompleteReminder
NotifSvc --> Host : ğŸ”” Push (1:1)

Scheduler --> NotifSvc : TripCompletedEvent
NotifSvc --> TripMember : ğŸ”” Push (Broadcast - Feedback Request)

@enduml
